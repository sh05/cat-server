# 実装計画: Docker Image作成機能

**ブランチ**: `006-docker-image-alpine` | **日付**: 2025-09-20 | **仕様書**: [spec.md](./spec.md)
**入力**: `/specs/006-docker-image-alpine/spec.md` からの機能仕様

## 実行フロー (/plan コマンド範囲)
```
1. 入力パスから機能仕様をロード
   → 機能仕様が正常にロードされました
2. 技術コンテキストを記入 (要明確化をスキャン)
   → プロジェクトタイプ: single (cat-serverコマンドラインツール)
   → ユーザー要求: 明確な成果物はDockerfileだけで結構
3. 憲法文書の内容に基づいて憲法チェックセクションを記入
4. 以下の憲法チェックセクションを評価
   → 憲法原則に適合 - 進行可能
   → 進捗追跡を更新: 初期憲法チェック
5. フェーズ0を実行 → research.md
6. フェーズ1を実行 → contracts, data-model.md, quickstart.md
7. 憲法チェックセクションを再評価
   → 進捗追跡を更新: 設計後憲法チェック
8. フェーズ2を計画 → タスク生成アプローチを説明 (tasks.mdは作成しない)
9. 停止 - /tasks コマンドの準備完了
```

**重要**: /planコマンドはステップ7で停止します。フェーズ2-4は他のコマンドで実行されます:
- フェーズ2: /tasks コマンドが tasks.md を作成
- フェーズ3-4: 実装実行 (手動またはツール経由)

## 概要
Alpine LinuxベースのマルチステージDockerイメージを作成し、cat-serverアプリケーションを軽量で効率的なコンテナとして配布可能にする。明確な成果物はDockerfileのみとし、シンプルで実用的なコンテナ化ソリューションを提供する。

## 技術コンテキスト
**言語/バージョン**: Go (最新安定版)
**主要依存関係**: Alpine Linux (base image), Docker
**ストレージ**: N/A (コンテナ化のみ)
**テスト**: Dockerイメージビルドテスト、コンテナ実行テスト
**対象プラットフォーム**: Linux (Docker)
**プロジェクトタイプ**: single - 既存のcat-serverコマンドラインツールをコンテナ化
**パフォーマンス目標**: 軽量イメージ (<50MB), 高速起動時間 (<2秒)
**制約**: Alpineベース必須、マルチステージビルド必須、セキュリティベストプラクティス
**規模/範囲**: 単一Dockerfileとビルドスクリプト

## 憲法チェック
*GATE: フェーズ0研究前に合格必須。フェーズ1設計後に再チェック。*

**言語ポリシー**:
- [x] 内部ドキュメント (仕様書、計画、タスク) は日本語で記述
- [x] 外部ドキュメント (README, APIドキュメント) は英語で記述
- [x] コードコメントとコミットは英語で記述

**Go標準**:
- [x] Go プログラミング言語のみを使用
- [x] Go コミュニティのベストプラクティスとイディオムに従う
- [x] 外部依存関係を最小化

**テスト要件**:
- [x] すべての関数/メソッドに対するユニットテストを計画
- [x] Go の組み込みテストフレームワークを使用
- [x] TDD アプローチ: 実装前にテスト

**品質ゲート**:
- [x] go vet, go fmt, go test, go build 検証を計画に含める
- [x] 品質ゲートのCI/CD強制を計画

**簡素性**:
- [x] 機能が cat-server のコア目的と一致 (デプロイメント効率化)
- [x] 不要な複雑性と抽象化を避ける (Dockerfileのみの成果物)

## プロジェクト構造

### ドキュメント (この機能)
```
specs/006-docker-image-alpine/
├── plan.md              # このファイル (/plan コマンド出力)
├── research.md          # フェーズ0出力 (/plan コマンド)
├── data-model.md        # フェーズ1出力 (/plan コマンド)
├── quickstart.md        # フェーズ1出力 (/plan コマンド)
├── contracts/           # フェーズ1出力 (/plan コマンド)
└── tasks.md             # フェーズ2出力 (/tasks コマンド - /plan では作成されない)
```

### ソースコード (リポジトリルート)
```
# オプション1: 単一プロジェクト (デフォルト)
Dockerfile               # 主要成果物
.dockerignore           # ビルド最適化
docker-compose.yml      # 開発環境用 (オプション)

src/
├── models/
├── services/
├── handlers/
└── main.go

tests/
├── docker/             # Dockerイメージテスト
├── integration/
└── unit/
```

**構造決定**: 既存の単一プロジェクト構造を維持し、ルートにDocker関連ファイルを追加

## フェーズ0: 概要と研究

### 要明確化項目の研究
1. **セキュリティ要件** → Alpine Linuxセキュリティベストプラクティス
2. **パフォーマンス要件** → Goアプリケーションのマルチステージビルド最適化
3. **デプロイメント要件** → Docker Hub/レジストリ連携なしの単純ビルド

### 研究タスク
- Alpine Linux + Goマルチステージビルドパターンの調査
- セキュリティベストプラクティス (非rootユーザー、最小権限)
- イメージサイズ最適化技術
- Docker Healthcheck実装パターン

**出力**: 決定事項を含む research.md

## フェーズ1: 設計とコントラクト
*前提条件: research.md 完了*

1. **機能仕様からエンティティを抽出** → `data-model.md`:
   - Dockerイメージ構造
   - ビルドステージ定義
   - 実行環境設定

2. **機能要件からビルドコントラクトを生成**:
   - Dockerfile命令セット
   - ビルド引数仕様
   - 実行時設定

3. **コントラクトからテストを生成**:
   - イメージビルドテスト
   - コンテナ実行テスト
   - セキュリティ検証テスト

4. **ユーザーストーリーからテストシナリオを抽出**:
   - ビルド成功シナリオ
   - アプリケーション実行シナリオ
   - サイズ要件検証

5. **エージェントファイルを増分的に更新**:
   - CLAUDE.md にDocker開発コマンドを追加

**出力**: data-model.md, /contracts/*, Dockerテスト, quickstart.md

## フェーズ2: タスク計画アプローチ
*このセクションは /tasks コマンドが行うことを説明 - /plan では実行しない*

**タスク生成戦略**:
- Dockerfile作成タスク [P]
- .dockerignore作成タスク [P]
- Docker ビルドテスト作成
- コンテナ実行テスト作成
- パフォーマンス検証テスト作成
- ドキュメント更新 (CLAUDE.md)

**順序戦略**:
- TDD順序: テスト → Dockerfile → 検証
- 並列実行: Dockerfileと.dockerignoreは独立 [P]

**推定出力**: tasks.md 内の8-10の番号付きタスク

**重要**: このフェーズは /tasks コマンドで実行され、/plan では実行されません

## フェーズ3以降: 今後の実装
*これらのフェーズは /plan コマンドの範囲外です*

**フェーズ3**: タスク実行 (/tasks コマンドが tasks.md を作成)
**フェーズ4**: 実装 (憲法原則に従って tasks.md を実行)
**フェーズ5**: 検証 (テスト実行、quickstart.md 実行、パフォーマンス検証)

## 複雑性追跡
*憲法チェックに正当化が必要な違反がある場合のみ記入*

適用なし - すべての憲法原則に適合

## 進捗追跡
*このチェックリストは実行フロー中に更新される*

**フェーズステータス**:
- [x] フェーズ0: 研究完了 (/plan コマンド)
- [x] フェーズ1: 設計完了 (/plan コマンド)
- [x] フェーズ2: タスク計画完了 (/plan コマンド - アプローチ説明のみ)
- [ ] フェーズ3: タスク生成 (/tasks コマンド)
- [ ] フェーズ4: 実装完了
- [ ] フェーズ5: 検証合格

**ゲートステータス**:
- [x] 初期憲法チェック: 合格
- [x] 設計後憲法チェック: 合格
- [x] すべての要明確化を解決
- [x] 複雑性逸脱を文書化

---
*憲法 v1.0.0 ベース - `.specify/memory/constitution.md` を参照*